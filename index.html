<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KaenenGPT</title>
  <style>
    :root {
      --blur: blur(12px);
      --glass: rgba(255,255,255,.06);
      --glass-strong: rgba(255,255,255,.12);
      --accent: #ffffff;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #000;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
    }

    /* ---------- star-field ---------- */
    #spaceCanvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    /* ---------- settings ---------- */
    #settingsBtn {
      position: fixed;
      top: 24px;
      right: 24px;
      width: 32px;
      height: 32px;
      border: 1px solid var(--glass-strong);
      border-radius: 50%;
      background: var(--glass);
      backdrop-filter: var(--blur);
      cursor: pointer;
      z-index: 10;
    }
    #settingsPanel {
      position: fixed;
      top: 70px;
      right: 24px;
      width: 220px;
      padding: 20px;
      background: rgba(0,0,0,.5);
      border: 1px solid var(--glass-strong);
      border-radius: 12px;
      color: #fff;
      font-size: 13px;
      display: none;
      z-index: 10;
      backdrop-filter: var(--blur);
    }
    #settingsPanel label { display: flex; align-items: center; margin: 10px 0; }
    #settingsPanel input[type="checkbox"] { margin-right: 8px; }

    /* ---------- chat area ---------- */
    #chatBox {
      width: min(680px, 92vw);
      max-height: 60vh;
      overflow-y: auto;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 5;
    }
    .bubble {
      max-width: 75%;
      padding: 12px 16px;
      border-radius: 12px;
      backdrop-filter: var(--blur);
      word-wrap: break-word;
      font-size: 15px;
      line-height: 1.4;
    }
    .user {
      align-self: flex-end;
      background: var(--glass-strong);
      color: #fff;
    }
    .ai {
      align-self: flex-start;
      background: var(--glass);
      color: #fff;
    }

    /* ---------- input ---------- */
    #inputRow {
      width: min(680px, 92vw);
      margin-bottom: 24px;
      display: flex;
      gap: 10px;
      z-index: 5;
    }
    #userInput {
      flex: 1;
      background: var(--glass);
      border: 1px solid var(--glass-strong);
      border-radius: 10px;
      padding: 14px 16px;
      color: #fff;
      font-size: 16px;
      outline: none;
      backdrop-filter: var(--blur);
    }
    #sendBtn {
      width: 48px;
      height: 48px;
      background: var(--glass-strong);
      border: 1px solid var(--glass-strong);
      border-radius: 10px;
      cursor: pointer;
      display: grid;
      place-content: center;
      backdrop-filter: var(--blur);
      transition: background .15s;
    }
    #sendBtn:active { background: var(--accent); }
    #sendBtn svg { width: 18px; height: 18px; fill: #fff; }
  </style>
</head>
<body>

<canvas id="spaceCanvas"></canvas>

<!-- settings -->
<div id="settingsBtn"></div>
<div id="settingsPanel">
  <label>Background</label>
  <input type="color" id="bgColorPicker" value="#000000" style="width:100%">

  <label><input type="checkbox" id="toggleStars" checked> Stars</label>
  <label>Star speed</label>
  <input type="range" id="starSpeed" min="0.1" max="3" step="0.1" value="1" style="width:100%">

  <label><input type="checkbox" id="toggleNebulae"> Nebulae</label>
  <label>Nebulae count</label>
  <input type="range" id="nebulaeCount" min="0" max="8" step="1" value="3" style="width:100%">
</div>

<!-- chat -->
<div id="chatBox"></div>

<!-- input -->
<div id="inputRow">
  <input id="userInput" placeholder="">
  <button id="sendBtn" aria-label="Send">
    <svg viewBox="0 0 24 24"><path d="M3 20v-6l8-2-8-2V4l19 8-19 8z"/></svg>
  </button>
</div>

<script>
/* ---------- canvas ---------- */
const canvas = document.getElementById('spaceCanvas');
const ctx = canvas.getContext('2d');
let w, h;
function resize() {
  w = canvas.width  = innerWidth;
  h = canvas.height = innerHeight;
}
addEventListener('resize', resize);
resize();

/* ---------- ORIGINAL STARS – now transparent & all directions ---------- */
const stars = [];
for (let i = 0; i < 200; i++) {
  const angle = Math.random() * Math.PI * 2; // 0-360°
  const speed = 0.2 + Math.random() * 0.8;
  stars.push({
    x: Math.random() * w,
    y: Math.random() * h,
    vx: Math.cos(angle) * speed,
    vy: Math.sin(angle) * speed
  });
}
let starSpeedMult = 1;
function drawStars() {
  ctx.save();
  ctx.globalAlpha = 0.35; // more transparent
  ctx.fillStyle = '#fff';
  stars.forEach(s => {
    ctx.beginPath();
    ctx.arc(s.x, s.y, 2, 0, Math.PI * 2);
    ctx.fill();
    s.x += s.vx * starSpeedMult;
    s.y += s.vy * starSpeedMult;
    if (s.x < 0) s.x = w;
    if (s.x > w) s.x = 0;
    if (s.y < 0) s.y = h;
    if (s.y > h) s.y = 0;
  });
  ctx.restore();
}

/* ---------- nebulae ---------- */
const nebulae = [];
function rebuildNebulae(count) {
  nebulae.length = 0;
  for (let i = 0; i < count; i++) {
    nebulae.push({
      x: Math.random() * w,
      y: Math.random() * h,
      r: 120 + Math.random() * 180,
      hue: 200 + Math.random() * 220,
      drift: (Math.random() - .5) * .15
    });
  }
}
rebuildNebulae(3);
function drawNebulae() {
  nebulae.forEach(n => {
    const grad = ctx.createRadialGradient(n.x, n.y, 0, n.x, n.y, n.r);
    grad.addColorStop(0, `hsla(${n.hue},70%,50%,.18)`);
    grad.addColorStop(.7, `hsla(${n.hue},70%,50%,.06)`);
    grad.addColorStop(1, 'transparent');
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
    ctx.fill();
    n.x += n.drift;
    if (n.x < -n.r) n.x = w + n.r;
    if (n.x > w + n.r) n.x = -n.r;
  });
}

/* ---------- animation ---------- */
let starsEnabled   = true;
let nebulaeEnabled = false;
function animate() {
  ctx.clearRect(0, 0, w, h);
  if (nebulaeEnabled) drawNebulae();
  if (starsEnabled)   drawStars();
  requestAnimationFrame(animate);
}
animate();

/* ---------- settings ---------- */
const panel = document.getElementById('settingsPanel');
document.getElementById('settingsBtn').onclick = () => {
  panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
};
document.getElementById('toggleStars').onchange   = e => starsEnabled   = e.target.checked;
document.getElementById('toggleNebulae').onchange = e => nebulaeEnabled = e.target.checked;
document.getElementById('bgColorPicker').oninput = e => document.body.style.background = e.target.value;

// star-speed slider
document.getElementById('starSpeed').oninput = e => starSpeedMult = parseFloat(e.target.value);

// nebulae-count slider
document.getElementById('nebulaeCount').oninput = e => rebuildNebulae(parseInt(e.target.value, 10));

/* ---------- chat ---------- */
const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');

function addBubble(text, sender) {
  const div = document.createElement('div');
  div.className = 'bubble ' + sender;
  div.textContent = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

async function sendMsg() {
  const text = userInput.value.trim();
  if (!text) return;
  userInput.value = '';
  addBubble(text, 'user');

  const res = await fetch('/.netlify/functions/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: text })
  });
  const data = await res.json();
  addBubble(data.reply, 'ai');
}
document.getElementById('sendBtn').addEventListener('click', sendMsg);
userInput.addEventListener('keydown', e => { if (e.key === 'Enter') sendMsg(); });
</script>
</body>
</html>
